{% extends 'base.html' %}
{% block title %}Movimientos de Inventario{% endblock %}
{% block content %}
<h2>Historial de Movimientos de Inventario</h2>
<form method="get" class="list-search" style="margin:1rem 0;">
  <input type="text" name="q" value="{{ q }}" placeholder="Buscar por producto o tipo">
  <button class="btn btn-primary" type="submit">Buscar</button>
  {% if q %}<a href="{% url 'movimientos_inventario' %}" class="btn btn-secondary"> Limpiar</a>{% endif %}
</form>
<div class="table-wrapper">
<table>
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Producto</th>
      <th>Tipo</th>
      <th>Cambio</th>
      <th>Cantidad previa</th>
      <th>Cantidad nueva</th>
      <th>Origen</th>
      <th>Nota</th>
    </tr>
  </thead>
  <tbody>
    {% for m in movimientos %}
    <tr>
      <td>{{ m.timestamp|date:'d/m/Y H:i' }}</td>
      <td>{{ m.producto.nombre }} ({{ m.producto.id_producto }})</td>
      <td>{{ m.change_type }}</td>
      <td>{% if m.quantity_change > 0 %}+{% endif %}{{ m.quantity_change }}</td>
      <td>{{ m.previous_quantity }}</td>
      <td>{{ m.new_quantity }}</td>
      <td>{{ m.source|default:'-' }}</td>
      <td>{{ m.note|default:'-' }}</td>
    </tr>
    {% empty %}
    <tr><td colspan="8">Sin movimientos registrados</td></tr>
    {% endfor %}
  </tbody>
</table>
</div>
{% endblock %}
