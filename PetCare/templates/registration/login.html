{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Iniciar sesión | PetCare</title>
  <link rel="icon" type="image/png" href="{% static 'img/icons/veterinarioFAV.png' %}">
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
  <link rel="stylesheet" href="{% static 'css/paws.css' %}">
  <style>
    .login-page { position: relative; z-index: 1; }
    .login-card { position: relative; z-index: 2; }
    .login-options { margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid #e0e0e0; }
    .register-buttons { display: flex; flex-direction: column; gap: 10px; margin-top: 1rem; }
    .btn-register { background: #28a745; color: white; border: none; padding: 12px; border-radius: 8px; text-decoration: none; text-align: center; font-weight: 500; transition: background 0.3s; display: flex; align-items: center; justify-content: center; }
    .btn-register:hover { background: #218838; }
    .btn-register-admin { background: #ffc107; color: #212529; }
    .btn-register-admin:hover { background: #e0a800; }
    .login-extra { margin-top: 1.5rem; text-align: center; }
    .btn-register img, .login-logo img { vertical-align: middle; margin-right: 8px; display: inline-block; }
    .login-logo img { width: 64px; height: 64px; }
    .btn-register img { width: 28px; height: 28px; margin: 0; margin-right: 10px; }
  </style>
</head>
<body class="login-page">
  <!-- Gradiente sutil y capas de patitas -->
  <div class="login-bg-gradient"></div>
  <div class="paw-layer paws-back" id="pawsBack"></div>
  <div class="paw-layer paws-mid" id="pawsMid"></div>
  <div class="paw-layer paws-top" id="pawsTop"></div>
  
  <div class="login-card">
    <div class="login-logo"><img src="{% static 'img/icons/Patitas-removebg.png' %}" alt="PetCare"></div>
    <h2>Iniciar Sesión - PetCare</h2>

    {% if form.errors %}
      <div class="message error">Usuario o contraseña inválidos. Inténtalo nuevamente.</div>
    {% endif %}

    {% if next and user.is_authenticated %}
      <div class="message error">Tu cuenta no tiene acceso a esta página.</div>
    {% endif %}

    <form method="post" action="{% url 'login' %}">
      {% csrf_token %}
      <div class="form-group">
        <label for="id_username">Usuario</label>
        <input type="text" name="username" autofocus required id="id_username" placeholder="Ingresa tu usuario">
      </div>
      <div class="form-group">
        <label for="id_password">Contraseña</label>
        <input type="password" name="password" required id="id_password" placeholder="Ingresa tu contraseña">
      </div>
      {% if next %}
        <input type="hidden" name="next" value="{{ next }}">
      {% endif %}
      <div class="form-actions">
        <button type="submit" class="btn login-btn">Iniciar Sesion</button>
      </div>
    </form>

    <!-- SECCIÓN DE REGISTRO -->
    <div class="login-options">
      <h3 style="text-align: center; margin-bottom: 1rem; color: #555;">¿No tienes cuenta?</h3>
      <div class="register-buttons">
        <a href="{% url 'registrar_usuario' %}" class="btn-register">
          <img src="{% static 'img/icons/Register.png' %}" alt=""> Registrarme como Usuario Normal
        </a>
        <a href="{% url 'registrar_admin' %}" class="btn-register btn-register-admin">
          <img src="{% static 'img/icons/Solicitar.png' %}" alt=""> Solicitar Cuenta de Administrador
        </a>
      </div>
    </div>

    <p class="login-extra">
      ¿Olvidaste tu contraseña? <a href="{% url 'password_reset' %}">Recupérala aquí</a>
    </p>
  </div>

  <script>
    // Enviar con Enter dentro del formulario
    document.querySelector('.login-card form')?.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') { e.currentTarget.submit(); }
    });
    // Set icon path for shared paws script
    window.PAWS_ICON_SRC = "{% static 'img/icons/Patitas-removebg.png' %}";
  </script>
  <script src="{% static 'js/paws.js' %}"></script>
</body>
</html>